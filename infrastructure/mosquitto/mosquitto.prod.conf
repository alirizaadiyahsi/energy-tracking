# Mosquitto Configuration for Production
# ======================================

# General Settings
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice

# Connection Settings
listener 1883
max_connections 10000
max_inflight_messages 20
max_queued_messages 100

# SSL/TLS Configuration
listener 8883
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
tls_version tlsv1.2
require_certificate false

# WebSocket Support with SSL
listener 9001
protocol websockets
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

# Security Settings
allow_anonymous false
password_file /mosquitto/config/passwd
acl_file /mosquitto/config/acl.conf

# Message Settings
message_size_limit 2097152
persistent_client_expiration 1h

# Logging (Reduced for Production)
connection_messages false
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Retained Messages
max_retained_messages 10000
retained_persistence true

# Performance Tuning
sys_interval 60
store_clean_interval 60
max_packet_size 2097152

# Client Settings
idle_timeout 300
keepalive_interval 60

# Rate Limiting
max_publish_rate 100
max_subscribe_rate 10

# Memory Management
memory_limit 512MB

# Persistence Settings
autosave_interval 1800
autosave_on_changes false

# Queue Settings
upgrade_outgoing_qos false
max_queued_messages 100

# Security Headers
add_timestamp true
